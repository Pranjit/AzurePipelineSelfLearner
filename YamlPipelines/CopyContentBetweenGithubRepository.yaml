#Defines branches or paths that trigger the pipeline.
trigger : 
   - none

#Specifies where jobs run (Microsoft-hosted or self-hosted agents). Here we used selfhosted agent.   
pool:
  name: 'Selfhosted'

resources:
  repositories:
    # Source repository
    - repository: AzurePipelineSelfLearner
      type: github
      name: pranjit/AzurePipelineSelfLearner
      endpoint: AzurePipelineUnivercity 
      ref: refs/heads/main
   
    # Destination repository
    - repository: OnlineResources
      type: github
      name: pranjit/OnlineResources
      endpoint: OnlineResources 
      ref: refs/heads/main

#The smallest unit of execution like scripts or predefined tasks.
steps:
 # Step 1: Checkout source repo
   - checkout: AzurePipelineSelfLearner
     persistCredentials: true
     clean: true
 # Step 1: Checkout destination repo
   - checkout: OnlineResources
     persistCredentials: true
     clean: true

# Step 3: Copy file using Windows PowerShell
   - powershell: |
      Write-Host "Copying file from SourceRepo to DestinationRepo..."
      Copy-Item -Path "AzurePipelineSelfLearner\FileUpload\test.txt" -Destination "OnlineResources\FileUpload\" -Force
     displayName: "Copy File to Destination Repo"
# Step 4: Commit and push to destination repo
   - powershell: |
      Set-Location -Path "$(Build.SourcesDirectory)/OnlineResources"
      Write-Host "Current working directory:"
      Write-Host (Get-Location).Path
      
      Write-Host "Current remote directory:"
      git remote -v
      
      # Configure Git identity
        git config user.email "kalita.pranjit@hotmail.com" 
        git config user.name "Azure Pipeline"   

      # Stage the copied file
        git add "FileUpload\test.txt"
       
      # Commit only if there are changes
      if ((git status --porcelain) -ne "") {
        git commit -m "Automated copy of test.txt from SourceRepo"
        git push origin main
        Write-Host "Changes committed and pushed successfully."
      } else {
        Write-Host "No changes to commit."
      }

     displayName: "Commit and Push Changes"
  

